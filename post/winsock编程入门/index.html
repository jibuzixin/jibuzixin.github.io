<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:site_name" content="腹有诗书气自华">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="img/小黑.png">
    <meta property="twitter:image" content="img/小黑.png" />
    

    
    <meta name="title" content="winsock编程入门" />
    <meta property="og:title" content="winsock编程入门" />
    <meta property="twitter:title" content="winsock编程入门" />
    

    
    <meta name="description" content=" ">
    <meta property="og:description" content=" " />
    <meta property="twitter:description" content=" " />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="赵化冰, zhaohuabing, Zhaohuabing, , 赵化冰的网络日志, 赵化冰的博客, Zhaohuabing Blog, 博客, 个人网站, 互联网, Web, 云原生, PaaS, Istio, Kubernetes, 微服务, Microservice">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>winsock编程入门 | yzy的博客</title>

    <link rel="canonical" href="/post/winsock%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8/">

    
    
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hugo-theme-cleanwhite.min.css">

    
    <link rel="stylesheet" href="/css/zanshang.css">

    
    <link href="https://cdn.jsdelivr.net/gh/FortAwesome/Font-Awesome@5.15.1/css/all.css" rel="stylesheet" type="text/css">

    
    

    
    <script src="/js/jquery.min.js"></script>

    
    <script src="/js/bootstrap.min.js"></script>

    
    <script src="/js/hux-blog.min.js"></script>

    
    <script src="/js/lazysizes.min.js"></script>

    
    

</head>






<nav class="navbar navbar-default navbar-custom navbar-fixed-top">

    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">腹有诗书气自华</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">所有文章</a>
                    </li>
                    
                        
                        <li>
                            <a href="/categories/c/c&#43;&#43;">c/c&#43;&#43;</a>
                        </li>
                        
                        <li>
                            <a href="/categories/go">go</a>
                        </li>
                        
                        <li>
                            <a href="/categories/java">java</a>
                        </li>
                        
                        <li>
                            <a href="/categories/linux">linux</a>
                        </li>
                        
                        <li>
                            <a href="/categories/python">python</a>
                        </li>
                        
                        <li>
                            <a href="/categories/%E5%89%8D%E7%AB%AF">前端</a>
                        </li>
                        
                        <li>
                            <a href="/categories/%E5%90%8E%E7%AB%AF">后端</a>
                        </li>
                        
                        <li>
                            <a href="/categories/%E7%94%9F%E6%B4%BB">生活</a>
                        </li>
                        
                    
                    
		    
                        <li><a href="/notes/">编程历程</a></li>
                    
                        <li><a href="/about/">关于我</a></li>
                    
		            <li>
                        <a href="/search"><i class="fa fa-search"></i></a>
		           </li>
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('/img/%e5%b0%8f%e9%bb%91.png')
    }
</style>

<header class="intro-header" >

    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B" title="网络编程">
                            网络编程
                        </a>
                        
                    </div>
                    <h1>winsock编程入门</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        
                            Posted by 
                            
                                忌不自信
                             
                            on 
                            Monday, July 5, 2021
                            
                            
                            
                            
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                
                <p>(WinSocket自学开始)</p>
<h1 id="一声明">一、声明</h1>
<p>本人在自学过程中在此记录学习心得，如果内容有欠妥的地方还请在此下方批评，或私信，谢谢阅读。</p>
<h1 id="二常用的基本函数">二、常用的基本函数</h1>
<h2 id="21-头文件">2.1 头文件</h2>
<p>使用WinSocket编写程序的时候，要用到几个重要的文件，<code>winsock2.h</code>，静态链接库文件<code>ws2_32.lib</code>，以及动态链接库<code>ws2_32.dll</code>，头文件是用在源程序中，静态链接库是用来编译基于Winsock程序的，而动态链接库<code>ws2_32.dll</code>是运行基于WinSock的程序所必须的。</p>
<h2 id="22-函数">2.2 函数</h2>
<p>参考书目：《网络安全编程技术与实例》08年。
参考文档：<a href="https://docs.microsoft.com/en-us/windows/">微软文档</a></p>
<h3 id="221-htonl函数">2.2.1 htonl函数</h3>
<p>将主机的<code>u_long</code>值转换成网络字节顺序（32位）。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#6272a4">//原型	u_long htonl(u_long hostlong)
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">#include</span> <span style="color:#ff79c6">&lt;winsock2.h&gt;</span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">#include</span> <span style="color:#ff79c6">&lt;stdio.h&gt;</span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">#pragma comment(lib, &#34;ws2_32.lib&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6"></span><span style="color:#8be9fd">void</span> <span style="color:#50fa7b">main</span>(){
</span></span><span style="display:flex;"><span>	u_long a <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0x12345678</span>;
</span></span><span style="display:flex;"><span>	u_long b <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">htonl</span>(a);
</span></span><span style="display:flex;"><span>	<span style="color:#50fa7b">printf</span>(<span style="color:#f1fa8c">&#34;%x</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>, b);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="222ntohl函数">2.2.2ntohl函数</h3>
<p>将32位网络字节顺序转化为主机字节。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#6272a4">//原型	u_long ntohl(u_long netlong)
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">#include</span> <span style="color:#ff79c6">&lt;winsock2.h&gt;</span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">#include</span> <span style="color:#ff79c6">&lt;stdio.h&gt;</span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">#pragma comment(lib, &#34;ws2_32.lib&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6"></span><span style="color:#8be9fd">void</span> <span style="color:#50fa7b">main</span>(){
</span></span><span style="display:flex;"><span>	u_long a <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0x12345678</span>;
</span></span><span style="display:flex;"><span>	u_long b <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">ntohl</span>(a);
</span></span><span style="display:flex;"><span>	<span style="color:#50fa7b">printf</span>(<span style="color:#f1fa8c">&#34;%x</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>, b);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="223-ntohs函数">2.2.3 ntohs函数</h3>
<p>将16位网络字节转换为主机字节。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#6272a4">//原型	u_short ntohs(u_short netshort)
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">#include</span> <span style="color:#ff79c6">&lt;winsock2.h&gt;</span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">#include</span> <span style="color:#ff79c6">&lt;stdio.h&gt;</span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">#pragma comment(lib, &#34;ws2_32.lib&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6"></span><span style="color:#8be9fd">void</span> <span style="color:#50fa7b">main</span>(){
</span></span><span style="display:flex;"><span>	u_short a <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0x12345678</span>;
</span></span><span style="display:flex;"><span>	u_short b <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">ntohs</span>(a);
</span></span><span style="display:flex;"><span>	<span style="color:#50fa7b">printf</span>(<span style="color:#f1fa8c">&#34;%x</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>, b);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="224-htons函数">2.2.4 htons函数</h3>
<p>将16位主机字节转换为网络字节顺序。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#6272a4">//原型	u_short htons(u_short hostshort)
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">#include</span> <span style="color:#ff79c6">&lt;winsock2.h&gt;</span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">#include</span> <span style="color:#ff79c6">&lt;stdio.h&gt;</span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">#pragma comment(lib, &#34;ws2_32.lib&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6"></span><span style="color:#8be9fd">void</span> <span style="color:#50fa7b">main</span>(){
</span></span><span style="display:flex;"><span>	u_short a <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0x12345678</span>;
</span></span><span style="display:flex;"><span>	u_short b <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">htons</span>(a);
</span></span><span style="display:flex;"><span>	<span style="color:#50fa7b">printf</span>(<span style="color:#f1fa8c">&#34;%x</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>, b);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="225-inet_pton-和-inet_ntop-函数">2.2.5 inet_pton 和 inet_ntop 函数</h3>
<p>参考<a href="https://blog.csdn.net/zyy617532750/article/details/58595700">这篇</a>（点击阅读）文章，其中的有关这两个函数都有解释，我们这里直接给出样例。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#ff79c6">#include</span><span style="color:#ff79c6">&lt;WinSock2.h&gt;</span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">#include</span><span style="color:#ff79c6">&lt;stdio.h&gt;</span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">#pragma comment(lib, &#34;ws2_32.lib&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">#include</span> <span style="color:#ff79c6">&lt;Ws2tcpip.h&gt;</span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6"></span><span style="color:#8be9fd">void</span> <span style="color:#50fa7b">main</span>(){
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd">char</span> a[] <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;192.168.1.3&#34;</span>;	<span style="color:#6272a4">//创建一个字符串形式的IP地址
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	<span style="color:#ff79c6">struct</span> in_addr s;			<span style="color:#6272a4">//创建一个接受IP地址转换后的变量，用来存储二进制形式的
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	<span style="color:#ff79c6">if</span> (<span style="color:#50fa7b">inet_pton</span>(AF_INET, a, <span style="color:#ff79c6">&amp;</span>s) <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">1</span>)<span style="color:#50fa7b">printf</span>(<span style="color:#f1fa8c">&#34;ok</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>);	<span style="color:#6272a4">//如果成功会返回1
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	<span style="color:#50fa7b">printf</span>(<span style="color:#f1fa8c">&#34;%s-&gt;%u</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>, a, s);
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">if</span> (<span style="color:#50fa7b">inet_ntop</span>(AF_INET, <span style="color:#ff79c6">&amp;</span>s, a, <span style="color:#ff79c6">sizeof</span>(a)) <span style="color:#ff79c6">!=</span> <span style="color:#8be9fd;font-style:italic">NULL</span>)<span style="color:#50fa7b">puts</span>(<span style="color:#f1fa8c">&#34;ok&#34;</span>);	<span style="color:#6272a4">//再转换回去看看
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	<span style="color:#50fa7b">printf</span>(<span style="color:#f1fa8c">&#34;%s-&gt;%u</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>, a, s);	
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>其中结构体<code>in_addr</code>为：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#ff79c6">struct</span> in_addr{
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">union</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">struct</span>{ u_char s_b1, s_b2, s_b3, s_b4;}S_un_b;
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">struct</span>{ u_short s_w1, s_w2;} S_un_w;
</span></span><span style="display:flex;"><span>		u_long S_addr;
</span></span><span style="display:flex;"><span>	}S_un;
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>目前我们只需注意<code>u_long S_addr</code>就可以了。</p>
<h3 id="226-wsastartup-和-wsacleanup函数">2.2.6 WSAStartup 和 WSACleanup函数</h3>
<p><code>WSAStartup</code>其功能是为初始化Winsock，在使用套接字函数前都应该调用。其本质是调用合适的WinSock动态链接库。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">WSAStartup</span>(WORD wVersionRequested, LPWSADATA lpWSAData);
</span></span></code></pre></div><p>第一个参数是WinSock版本，用MAKEWORD宏来表示，例如：MAKEWORD（2,1）表示2.1版本。
第二个参数表示WSAData指针，它用来存储套接字信息。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#ff79c6">typedef</span> <span style="color:#ff79c6">struct</span> WSAData{...}WSADATA,<span style="color:#ff79c6">*</span>LPWSADATA;
</span></span></code></pre></div><p>其内容需要的话百度关键字。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">WSACleanup</span>(<span style="color:#8be9fd">void</span>);
</span></span></code></pre></div><p>此函数表示停止使用Winsock 2 DLL。</p>
<h3 id="227-gethostname函数">2.2.7 gethostname函数</h3>
<p>次函数用来获取主机名称，直接看例子。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#ff79c6">#include</span><span style="color:#ff79c6">&lt;WinSock2.h&gt;</span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">#include</span><span style="color:#ff79c6">&lt;stdio.h&gt;</span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">#pragma comment(lib, &#34;ws2_32.lib&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6">#include</span> <span style="color:#ff79c6">&lt;Ws2tcpip.h&gt;</span><span style="color:#ff79c6">
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6"></span><span style="color:#8be9fd">void</span> <span style="color:#50fa7b">main</span>()[
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd">char</span> hostname[<span style="color:#bd93f9">100</span>];		<span style="color:#6272a4">//存放主机字符串的数组
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	WSADATA wsaData;
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd">int</span> Ret;
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">if</span> (Ret <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">WSAStartup</span>(<span style="color:#50fa7b">MAKEWORD</span>(<span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">2</span>), <span style="color:#ff79c6">&amp;</span>wsaData) <span style="color:#ff79c6">!=</span> <span style="color:#bd93f9">0</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#50fa7b">printf</span>(<span style="color:#f1fa8c">&#34;uperror %d</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>, Ret);
</span></span><span style="display:flex;"><span>		<span style="color:#50fa7b">exit</span>(EXIT_SUCCESS);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">//函数的使用
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	<span style="color:#ff79c6">if</span> (<span style="color:#50fa7b">gethostname</span>(hostname, <span style="color:#ff79c6">sizeof</span>(hostname)) <span style="color:#ff79c6">==</span> SOCKET_ERROR) {
</span></span><span style="display:flex;"><span>		<span style="color:#50fa7b">printf</span>(<span style="color:#f1fa8c">&#34;erroe gethostname&#34;</span>);
</span></span><span style="display:flex;"><span>		<span style="color:#50fa7b">exit</span>(EXIT_SUCCESS);
</span></span><span style="display:flex;"><span>	}<span style="color:#ff79c6">else</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#50fa7b">printf</span>(<span style="color:#f1fa8c">&#34;hostname:%s</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>, hostname);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">if</span> (<span style="color:#50fa7b">WSACleanup</span>() <span style="color:#ff79c6">==</span> SOCKET_ERROR) {
</span></span><span style="display:flex;"><span>		<span style="color:#50fa7b">printf</span>(<span style="color:#f1fa8c">&#34;cleanerror</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>		<span style="color:#50fa7b">exit</span>(<span style="color:#bd93f9">0</span>);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="228-getaddrinfo-和-getnameinfo函数">2.2.8 getaddrinfo 和 getnameinfo函数</h3>
<p>推荐两个中文的解释<a href="https://www.cnblogs.com/LubinLew/p/POSIX-getaddrinfo.html">getaddrinfo</a>和<a href="https://www.cnblogs.com/LubinLew/p/POSIX-DataStructure.html#struct_addrinfo">addrinfo</a>。（其实是同一个）
另外我们也可以看看<a href="https://docs.microsoft.com/en-us/windows/win32/api/ws2tcpip/nf-ws2tcpip-getaddrinfo">原官方文档</a>。
以下是我的见解：
（首先我先从以上内容中摘取一些方便观看，如有争议可以私信）</p>
<h4 id="getaddrinfo"><strong>getaddrinfo：</strong></h4>
<p><code>getaddrinfo</code>定义：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">getaddrinfo</span>(<span style="color:#ff79c6">const</span> <span style="color:#8be9fd">char</span> <span style="color:#ff79c6">*</span><span style="color:#ff79c6">restrict</span> nodename, <span style="color:#6272a4">/* host 或者IP地址 */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">const</span> <span style="color:#8be9fd">char</span> <span style="color:#ff79c6">*</span><span style="color:#ff79c6">restrict</span> servname, <span style="color:#6272a4">/* 十进制端口号 或者常用服务名称如&#34;ftp&#34;、&#34;http&#34;等 */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">const</span> <span style="color:#ff79c6">struct</span> addrinfo <span style="color:#ff79c6">*</span><span style="color:#ff79c6">restrict</span> hints, <span style="color:#6272a4">/* 获取信息要求设置 */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">struct</span> addrinfo <span style="color:#ff79c6">**</span><span style="color:#ff79c6">restrict</span> res); <span style="color:#6272a4">/* 获取信息结果 */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd">void</span> <span style="color:#50fa7b">freeaddrinfo</span>(<span style="color:#ff79c6">struct</span> addrinfo <span style="color:#ff79c6">*</span>ai); 
</span></span></code></pre></div><p>前两个参数就不过多赘述了，我们看后两个参数，两个都是相同的结构体指针，hints是用来设置接收这个结构体的信息的。res用来接收最终信息的结构体指针的指针，所以我们要传进去一个指针的地址。
<strong>返回值：</strong> 成功返回0，否则返回一个非零，用<code>gai_strerrorA（int ecode）</code>接受一个返回的字符串指针来检查错误。
<code>freeaddrinfo</code>用来释放获取的<code>addrinfo</code>结构体或者结构体链表一系列的内存空间。
<strong>相关结构体：</strong>
<code>addrinfo</code>定义：
<a href="https://www.jianshu.com/p/df165c54d0b2">来自</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#ff79c6">struct</span> addrinfo {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> ai_flags;   <span style="color:#6272a4">/* AI_PASSIVE, AI_CANONNAME, AI_NUMERICHOST */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> ai_family;  <span style="color:#6272a4">/* PF_xxx */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> ai_socktype;    <span style="color:#6272a4">/* SOCK_xxx */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">int</span> ai_protocol;    <span style="color:#6272a4">/* 0 or IPPROTO_xxx for IPv4 and IPv6 */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">socklen_t</span> ai_addrlen;   <span style="color:#6272a4">/* length of ai_addr */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">char</span>    <span style="color:#ff79c6">*</span>ai_canonname;  <span style="color:#6272a4">/* canonical name for hostname */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">struct</span>  sockaddr <span style="color:#ff79c6">*</span>ai_addr;  <span style="color:#6272a4">/* binary address */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">struct</span>  addrinfo <span style="color:#ff79c6">*</span>ai_next;  <span style="color:#6272a4">/* next structure in linked list */</span>
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>在初始化这个结构体的时候我们一般都初始化为0就可以了。（目前来说）
这里我们再集中学习几个结构体一起来分析：
<code>sockaddr</code>定义：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#ff79c6">struct</span> sockaddr
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">sa_family_t</span>  sa_family;   <span style="color:#6272a4">//ushort类型 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#8be9fd">char</span>         sa_data[<span style="color:#bd93f9">14</span>]; <span style="color:#6272a4">// Socket address (variable-length data). 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>};
</span></span></code></pre></div><p><code>sockaddr_in</code>定义：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#ff79c6">struct</span> sockaddr_in
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">sa_family_t</span>     sin_family;   <span style="color:#6272a4">//AF_INET. 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#8be9fd">in_port_t</span>       sin_port;     <span style="color:#6272a4">//Port number(网络字节序). 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">struct</span> in_addr  sin_addr;     <span style="color:#6272a4">//IP address(网络字节序).
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#8be9fd">char</span>[<span style="color:#bd93f9">8</span>] sin_zero;			<span style="color:#6272a4">//目前我还不知道用途
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>};
</span></span></code></pre></div><p><code>sockaddr_in6</code>定义：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#ff79c6">struct</span> sockaddr_in6{
</span></span><span style="display:flex;"><span>	u_short sin6_family;
</span></span><span style="display:flex;"><span>	u_short sin6_port;
</span></span><span style="display:flex;"><span>	u_long sin6_flowinfo;
</span></span><span style="display:flex;"><span>	in6_addr sin6_addr;
</span></span><span style="display:flex;"><span>	u_long sin6_scope_id;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">typedef</span> <span style="color:#ff79c6">struct</span> sockaddr_in6 SOCKADDR_IN6;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">typedef</span> <span style="color:#ff79c6">struct</span> sockaddr_in6 <span style="color:#ff79c6">*</span>PSOCKADDR_IN6;
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">typedef</span> <span style="color:#ff79c6">struct</span> sockaddr_in6 FAR <span style="color:#ff79c6">*</span>LPSOCKADDR_IN6;
</span></span></code></pre></div><p><code>sockaddr_in</code>和<code>sockaddr_in6</code>分别对应IPv4和IPv6。
以上结构体关系我简单画了一个联系仅供参考：

  <img src="https://img-blog.csdnimg.cn/ca37e30c13b84f328e5199cb0bd43bf1.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAbTBfNTQ3ODY3OTI=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="addrinfo,sockaddr关系">


其次sockaddr可以在使用的过程中强制转换成IPv4和IPv6的结构体类型，其中我们会发现IPv6结构体类型的内存大小会与sockaddr内存大小不一致，但在强制转换的过程中信息却可以完好的保留，在我的好友帮助下我们猜测应该是在使用内置函数的里面，存在一个内存分配的问题（因为结构体里面都是指针），所以强制转换可以实现应对不同的IP。</p>
<h4 id="getnameinfo"><strong>getnameinfo：</strong></h4>
<p><code>getnameinfo</code>定义：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>INT WSAAPI <span style="color:#50fa7b">getnameinfo</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">const</span> SOCKADDR <span style="color:#ff79c6">*</span>pSockaddr,	<span style="color:#6272a4">//包含地址和端口号的sockaddr结构体
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#8be9fd">socklen_t</span>      SockaddrLength,	<span style="color:#6272a4">//传入一个地址结构体的字节长度
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  PCHAR          pNodeBuffer,	<span style="color:#6272a4">//用来接收返回的主机名字符串
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  DWORD          NodeBufferSize,	<span style="color:#6272a4">//用于分配接收主机名字符串的空间，一般使用sizeof
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  PCHAR          pServiceBuffer,	<span style="color:#6272a4">//同理是接收服务名的
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  DWORD          ServiceBufferSize,	<span style="color:#6272a4">//同理一般使用sizeof
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  INT            Flags
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><p><strong>参考文档：</strong><a href="https://docs.microsoft.com/en-us/windows/win32/api/ws2tcpip/nf-ws2tcpip-getnameinfo">链接</a>
getnameinfo函数可以实现地址到主机名，端口号到服务名的解析。
<strong>参数说明：</strong></p>
<ul>
<li><code>pSockaddr</code>如果不是sockaddr类型，相应的IPv4传递sockaddr_in，IPv6传递sockaddr_in6。</li>
<li><code>SockaddrLength</code>如果是addrinfo指针，我们可以使用这个结构体里的ai_addrlen。如果是IPv4或者IPv6我们分别使用sizeof运算符来计算地址结构体的大小。</li>
<li><code>pNodeBuffer</code>和<code>pServiceBuffer</code>是要预先分配好内存空间。</li>
<li><code>Flags</code>有以下几种设置：
<code>NI_NAMEREQD</code>被设置的时候，如果主机名不能被域名系统解析（DNS），则返回error。
<code>NI_NOFQDN</code>被设置的时候，会返回给host参数一个本地主机具有的相对辨别名。（我也不清楚，还是看原文档的英文吧o(╥﹏╥)o）
<code>NI_NUMERICHOST</code>被设置的时候，会返回一个主机名称的数字形式来代替他本身的名称。如果它的名称不能被域名系统解析（DNS），也会返回。
<code>NI_NUMERICSERV</code>被设置的时候，返回服务的端口号，同时，如果主机名没有设置一个IP地址的话，主机名会作为IP地址被返回。
<code>NI_DGRAM</code>Setting the NI_DGRAM flag indicates that the service is a datagram service. This flag is necessary for the few services that provide different port numbers for UDP and TCP service.</li>
</ul>
<p><strong>返回值：</strong> 成功返回零，非零使用WSAGetLastError（void）检查错误（整形返回值）。错误列表可以自行搜索。</p>
<h4 id="family"><strong>family：</strong></h4>
<p><code>AF_INET</code>对应的IPv4；
<code>AF_INET6</code>对应IPv6；
<code>AF_UNSPEC</code>IPv4和IPv6都可以。
余下有关参数请参考<a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/network/af-inet">文档</a></p>
<h4 id="例子"><strong>例子：</strong></h4>
<p>结合前面获取的主机名，我们来解析IP。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>	<span style="color:#6272a4">//解析地址
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	<span style="color:#8be9fd">char</span> hostname[<span style="color:#bd93f9">100</span>];
</span></span><span style="display:flex;"><span>	WSADATA wsaData;
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd">int</span> Ret;
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">if</span> (Ret <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">WSAStartup</span>(<span style="color:#50fa7b">MAKEWORD</span>(<span style="color:#bd93f9">2</span>, <span style="color:#bd93f9">2</span>), <span style="color:#ff79c6">&amp;</span>wsaData) <span style="color:#ff79c6">!=</span> <span style="color:#bd93f9">0</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#50fa7b">printf</span>(<span style="color:#f1fa8c">&#34;uperror&#34;</span>);
</span></span><span style="display:flex;"><span>		<span style="color:#50fa7b">exit</span>(EXIT_SUCCESS);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">if</span> (<span style="color:#50fa7b">gethostname</span>(hostname, <span style="color:#ff79c6">sizeof</span>(hostname)) <span style="color:#ff79c6">==</span> SOCKET_ERROR) {
</span></span><span style="display:flex;"><span>		<span style="color:#50fa7b">printf</span>(<span style="color:#f1fa8c">&#34;erroe gethostname&#34;</span>);
</span></span><span style="display:flex;"><span>		<span style="color:#50fa7b">exit</span>(EXIT_SUCCESS);
</span></span><span style="display:flex;"><span>	}<span style="color:#ff79c6">else</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#50fa7b">printf</span>(<span style="color:#f1fa8c">&#34;hostname:%s</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>, hostname);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">//设置接收信息，创建接收返回信息的结构体指针getaddr，会在函数内分配空间
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	addrinfo <span style="color:#ff79c6">*</span>addrstr, <span style="color:#ff79c6">*</span>getaddr;
</span></span><span style="display:flex;"><span>	addrstr <span style="color:#ff79c6">=</span> (addrinfo<span style="color:#ff79c6">*</span>)<span style="color:#50fa7b">malloc</span>(<span style="color:#ff79c6">sizeof</span>(addrinfo));
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">//初始化为0
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	<span style="color:#50fa7b">memset</span>(addrstr, <span style="color:#bd93f9">0</span>, <span style="color:#ff79c6">sizeof</span>(addrinfo));
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">//地址族类型设置为AF_UNSPEC，即可为IPv4也可为IPv6
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	addrstr<span style="color:#ff79c6">-&gt;</span>ai_family <span style="color:#ff79c6">=</span> AF_UNSPEC;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">//创建临时变量
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	sockaddr_in<span style="color:#ff79c6">*</span> ipv4;
</span></span><span style="display:flex;"><span>	sockaddr_in6<span style="color:#ff79c6">*</span> ipv6;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd">int</span> s;
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">if</span> (s <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">getaddrinfo</span>(hostname, <span style="color:#f1fa8c">&#34;https&#34;</span>, addrstr, <span style="color:#ff79c6">&amp;</span>getaddr) <span style="color:#ff79c6">!=</span> <span style="color:#bd93f9">0</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#50fa7b">printf</span>(<span style="color:#f1fa8c">&#34;error getaddrstr:%s&#34;</span>, <span style="color:#50fa7b">gai_strerror</span>(s));
</span></span><span style="display:flex;"><span>		<span style="color:#50fa7b">exit</span>(EXIT_SUCCESS);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">//创建内存空间用来接收转换后的字符串
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	<span style="color:#8be9fd">char</span> buf[<span style="color:#bd93f9">1025</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">for</span> (addrinfo<span style="color:#ff79c6">*</span> re <span style="color:#ff79c6">=</span> getaddr; re <span style="color:#ff79c6">!=</span> <span style="color:#8be9fd;font-style:italic">NULL</span>; re <span style="color:#ff79c6">=</span> re<span style="color:#ff79c6">-&gt;</span>ai_next) {
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">switch</span>(re<span style="color:#ff79c6">-&gt;</span>ai_family) {
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">case</span> <span style="color:#8be9fd;font-style:italic">AF_INET</span>:
</span></span><span style="display:flex;"><span>			ipv4 <span style="color:#ff79c6">=</span> (sockaddr_in<span style="color:#ff79c6">*</span>)re<span style="color:#ff79c6">-&gt;</span>ai_addr;
</span></span><span style="display:flex;"><span>			<span style="color:#50fa7b">inet_ntop</span>(re<span style="color:#ff79c6">-&gt;</span>ai_family, <span style="color:#ff79c6">&amp;</span>ipv4<span style="color:#ff79c6">-&gt;</span>sin_addr, buf, <span style="color:#ff79c6">sizeof</span>(buf));
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">break</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">case</span> <span style="color:#8be9fd;font-style:italic">AF_INET6</span>:
</span></span><span style="display:flex;"><span>			ipv6 <span style="color:#ff79c6">=</span> (sockaddr_in6<span style="color:#ff79c6">*</span>)re<span style="color:#ff79c6">-&gt;</span>ai_addr;
</span></span><span style="display:flex;"><span>			<span style="color:#50fa7b">inet_ntop</span>(re<span style="color:#ff79c6">-&gt;</span>ai_family, <span style="color:#ff79c6">&amp;</span>ipv6<span style="color:#ff79c6">-&gt;</span>sin6_addr, buf, <span style="color:#ff79c6">sizeof</span>(buf));
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">break</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#50fa7b">printf</span>(<span style="color:#f1fa8c">&#34;[ipv%d]:%s</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>, re<span style="color:#ff79c6">-&gt;</span>ai_family <span style="color:#ff79c6">==</span> AF_INET <span style="color:#ff79c6">?</span> <span style="color:#bd93f9">4</span><span style="color:#ff79c6">:</span> <span style="color:#bd93f9">6</span>, buf);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#50fa7b">puts</span>(<span style="color:#f1fa8c">&#34;--------------------------------&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">//反过来应用getnameinfo函数解析
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	<span style="color:#8be9fd">int</span> ret <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>	addrinfo<span style="color:#ff79c6">*</span> res_p;
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">for</span> (res_p <span style="color:#ff79c6">=</span> getaddr; res_p <span style="color:#ff79c6">!=</span> <span style="color:#8be9fd;font-style:italic">NULL</span>; res_p <span style="color:#ff79c6">=</span> res_p<span style="color:#ff79c6">-&gt;</span>ai_next) {
</span></span><span style="display:flex;"><span>		<span style="color:#8be9fd">char</span> host[<span style="color:#bd93f9">1024</span>], servername[<span style="color:#bd93f9">1024</span>] <span style="color:#ff79c6">=</span> {<span style="color:#bd93f9">0</span>};
</span></span><span style="display:flex;"><span>		<span style="color:#50fa7b">memset</span>(host, <span style="color:#bd93f9">0</span>, <span style="color:#ff79c6">sizeof</span>(host));
</span></span><span style="display:flex;"><span>		<span style="color:#50fa7b">puts</span>(<span style="color:#f1fa8c">&#34;going&#34;</span>);
</span></span><span style="display:flex;"><span>		ret <span style="color:#ff79c6">=</span> <span style="color:#50fa7b">getnameinfo</span>(res_p<span style="color:#ff79c6">-&gt;</span>ai_addr, res_p<span style="color:#ff79c6">-&gt;</span>ai_addrlen, host, <span style="color:#ff79c6">sizeof</span>(host), servername, <span style="color:#ff79c6">sizeof</span>(servername), NI_NAMEREQD);
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">if</span> (ret <span style="color:#ff79c6">!=</span> <span style="color:#bd93f9">0</span>)
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			<span style="color:#50fa7b">printf</span>(<span style="color:#f1fa8c">&#34;getnameinfo: %s</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>, <span style="color:#50fa7b">gai_strerror</span>(ret));
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">else</span>
</span></span><span style="display:flex;"><span>		{
</span></span><span style="display:flex;"><span>			<span style="color:#50fa7b">printf</span>(<span style="color:#f1fa8c">&#34;hostname: %s	%s</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>, host, servername);
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#6272a4">//释放刚刚创建的getaddr指针空间
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>	<span style="color:#50fa7b">freeaddrinfo</span>(getaddr);
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">if</span> (<span style="color:#50fa7b">WSACleanup</span>() <span style="color:#ff79c6">==</span> SOCKET_ERROR) {
</span></span><span style="display:flex;"><span>		<span style="color:#50fa7b">printf</span>(<span style="color:#f1fa8c">&#34;cleanerror</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>);
</span></span><span style="display:flex;"><span>		<span style="color:#50fa7b">exit</span>(<span style="color:#bd93f9">0</span>);
</span></span><span style="display:flex;"><span>	}
</span></span></code></pre></div><h3 id="229-wsagetlasterror函数">2.2.9 WSAGetLastError函数</h3>
<p>在WinSock编程中遇到错误可以用此函数检查。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#8be9fd">int</span> <span style="color:#50fa7b">WSAGetLastError</span>(<span style="color:#8be9fd">void</span>);
</span></span></code></pre></div>

                

                
                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/post/gcc%E5%92%8Cg&#43;&#43;%E7%9A%84%E5%8C%BA%E5%88%AB/" data-toggle="tooltip" data-placement="top" title="gcc和g&#43;&#43;的区别">&larr;
                            Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/post/%E6%95%B0%E6%8D%AE%E9%9B%86%E5%92%8C%E7%89%B9%E5%BE%81%E6%8F%90%E5%8F%96/" data-toggle="tooltip" data-placement="top" title="数据集和特征提取">Next
                            Post &rarr;</a>
                    </li>
                    
                </ul>
                

                 

<script src="https://giscus.app/client.js"
        data-repo="jibuzixin/jibuzixin.github.io"
        data-repo-id="R_kgDOI_E1ug"
        data-category="Show and tell"
        data-category-id="DIC_kwDOI_E1us4CURld"
        data-mapping="url"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="1"
        data-input-position="top"
        data-theme="light"
        data-lang="zh-CN"
        crossorigin="anonymous"
        async>
</script>


            </div>

            
            
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
            

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href='/tags/linux' title="linux">
                            linux
                        </a>
                        
                        
                        
                        <a href='/tags/python' title="python">
                            python
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href='/tags/spring' title="spring">
                            spring
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href='/tags/%E5%89%8D%E7%AB%AF' title="前端">
                            前端
                        </a>
                        
                        
                        
                        <a href='/tags/%E5%90%8E%E7%AB%AF' title="后端">
                            后端
                        </a>
                        
                        
                        
                        
                        
                        <a href='/tags/%E6%8F%92%E4%BB%B6' title="插件">
                            插件
                        </a>
                        
                        
                        
                        <a href='/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0' title="机器学习">
                            机器学习
                        </a>
                        
                        
                        
                        <a href='/tags/%E7%94%9F%E6%B4%BB' title="生活">
                            生活
                        </a>
                        
                        
                        
                        
                        
                        <a href='/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B' title="网络编程">
                            网络编程
                        </a>
                        
                        
                        
                        <a href='/tags/%E8%84%9A%E6%9C%AC' title="脚本">
                            脚本
                        </a>
                        
                        
                    </div>
                </section>
                

                
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">                  
                    
                    <li>
                        <a href="mailto:this.jibuzixin@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		           
                    
                    
                    
                    

		            
                    
                    <li>
                        <a target="_blank" href="/img/%e5%be%ae%e4%bf%a1%e6%89%ab%e7%a0%81.png">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-weixin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		            
                    
                    <li>
                        <a target="_blank" href="https://github.com/jibuzixin">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		            
                    
                    
                    
                    
                    
                    
                    
                    
                    
            
            
            
           
             </ul>
		<p class="copyright text-muted">
                    Copyright &copy; 腹有诗书气自华 2023
                    <br>
                    
                    
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function loadAsync(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        loadAsync("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>






<script type="text/javascript">
    function generateCatalog(selector) {

        
        
        
        
            _containerSelector = 'div.post-container'
        

        
        var P = $(_containerSelector), a, n, t, l, i, c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        
        $(selector).html('')

        
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#" + $(this).prop('id');
            t = $(this).text();
            c = $('<a href="' + i + '" rel="nofollow">' + t + '</a>');
            l = $('<li class="' + n + '_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    
    $(".catalog-toggle").click((function (e) {
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    


    loadAsync("\/js\/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>






</body>
</html>
